----------
//
DROP PROCEDURE IF EXISTS registroUsuario;
DELIMITER $$

CREATE PROCEDURE registroUsuario(
    IN p_nombre VARCHAR(100),
    IN p_email VARCHAR(100),
    IN p_telefono VARCHAR(20),
    IN p_contrasena VARCHAR(255),
    IN p_rol VARCHAR(50)
)
BEGIN
    DECLARE dominio VARCHAR(50) DEFAULT '@santateresita.ac.cr';

    -- Validar dominio en min√∫sculas y sin espacios
    IF RIGHT(LOWER(TRIM(p_email)), LENGTH(dominio)) = dominio THEN
        INSERT INTO USUARIO (Nombre, Email, Telefono, Contrasena, Rol, Estado)
        VALUES (p_nombre, TRIM(p_email), p_telefono, p_contrasena, p_rol, 'Activo');
    ELSE
        SIGNAL SQLSTATE '45000'
        SET MESSAGE_TEXT = 'El correo debe ser institucional (@santateresita.ac.cr)';
    END IF;
END$$

DELIMITER ;


////////